

## vil kmeans altid give samme resultat?

Nej.

Her er 1000 helt tilfældige pupnkter:

```{r}
test_data <- data.frame(x = rnorm(1000), y = rnorm(1000))
```

Der er ingen struktur i de data. Eller, hvis der er, er der noget galt med tilfældighedsgeneratoren.

Men kmeans kan finde det antal clustre vi beder den om, uanset om der er struktur eller ej.

Lad os finde 5 clustre. Vi starter med at låse tilfældighedsgeneratoren, 
så vi får samme resultat når vi gør det samme i morgen. `augment` funktionen tager vores data, og tildeler det klasser baseret på kmeans resultatet:
```{r}
set.seed(42)
kmeans_model1 <- kmeans(test_data, 5)
cluster1 <- augment(kmeans_model1, test_data)
```


Vi kan også visualisere at data klassificeres forskelligt:
```{r}
første <- ggplot(cluster1, aes(x,y, color = .cluster)) +
  geom_point()

anden <- ggplot(cluster2, aes(x,y,color=.cluster)) +
  geom_point()

første + anden
```

k-means algoritmen er følsom overfor de tilfældige centroider der vælges i starten af den. Den bør dog, hvis der faktisk er struktur i data, 
give ca. samme resultat.

Der er data med tydelig struktur, hvor kmeans ikke kan finde den:

```{r sfærisk_data, echo = F}
test_data <- rbind(
data.frame(x = rnorm(200, 0,1), y = rnorm(200,0,1), z = rep("A", 200)),
data.frame(x = rnorm(400, 0,1)*10, y = rnorm(400,0,1)*10, z = rep("B", 200)) %>% 
             filter(abs(x*y)>15))
test_data %>% 
  ggplot(aes(x,y, color = z)) +
  geom_point()

```
Her er der tydelig struktur. En klasse ligger inde omkring 0,0, en anden klasse ligger rundt om, med pæn afstand til den første klasse.

Når vi træner en k-means model på det data, får vi ikke helt det vi forventer:
```{r}
kmeans_model3 <- kmeans(test_data[,-3], 2)
cluster3 <- augment(kmeans_model3, test_data[,-3])
```

```{r}
ggplot(cluster3, aes(x,y,color=.cluster)) +
  geom_point()

```

