---
title: 'which-distribution'
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- How do you write a lesson using R Markdown and `{sandpaper}`?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Explain how to use markdown with the new lesson template
- Demonstrate how to include pieces of code, figures, and nested challenge blocks

::::::::::::::::::::::::::::::::::::::::::::::::

## Introduction

Your data was not normally distributed. Now what?

The process generating your data is probably following some distribution.
The size distribution of cities appears to follow a Pareto distibution, as is
wealth. The number of mutations in a string of DNA appears to follow a 
poisson distribution. And the distribution of wind speeds as well as
times to failure for technical components both follow the Weibull distribution.

If you have a theoretical foundation for which distribution you data generating
function follows, that is nice. 

If you do not - we will be interested in figuring out which distribution your
data actually follow.

## How?

We fit our data to a distribution. Or rather - we fit the data to several
different distributions and then choose the best.

Let us look at some data. The `faithful` data set contains 272 observations of
the Old Faithful geyser in Yellowstone National Park in USA. We only look at 
eruptions that lasts longer than 3 minutes:

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
eruption_example <- faithful %>% 
  filter(eruptions > 3) %>% 
  select(eruptions)
```

Rather than testing a lot of different distributions, we can use the `gamlss`
package, and two add-ons to that.

```{r setup, message = FALSE, warning = FALSE}
library(gamlss)
library(gamlss.dist)
library(gamlss.add)
```

`gamlss` has the advantage of implementing a _lot_ of different statistical 
distributions.



The function `fitDist()` from `gamlss` will fit the data to a selection of different
statistical distributions, calculate a measure of the goodness of fit, and return
the best fit (and information on all the others). Rather than testing against all 
97 different distributions supported by `gamlss`, we can specify only a selection,
in this case `realplus`, that only includes the 23 distributions that are defined
for positive, real numbers:


```{r warning=FALSE, message=FALSE}
fit <- fitDist(eruptions, type = "realplus", data = eruption_example)
```

If you do this yourself, you will notice a lot of error-messages. It is not 
possible to fit this particular data to _all_ the distributions, and the ones
where the fit fails (enough), we will get an error message.

The output from `fitDist()` will return the best fit:

```{r}
fit
```
We are told that the statistical distribution that best fits the data is
`Weibull type 2` and that the AIC-measurement of goodness of fit is 170.245.

:::: callout
Is that a good fit? That is a good question. It strongly depends on the 
values in the dataset. In this dataset, the length of the eruptions are 
measured in minutes If we choose to measure that length in another unit, eg
seconds,
the distribution should not change. But the AIC will.

We can use the AIC to decide that one distribution fits the data better than 
another, but not to conclude that that distribution is the correct one.
::::

The `fit` object containing the output of the `fitDist()` function contains 
quite a bit more.

If we start by getting the errors out of the way, `fit$failed` returns the 
two distributions that failed enough to cause errors:

```{r}
fit$failed
```
As mentioned `fitDist()` fitted the data to 23 different distributions. We can
inspect the rest, and their associated AIC-values like this:

```{r}
fit$fits
```
Here we get `WEI2` first, with an AIC of 179.2449, but we can see that `WEI3` and
`WEI1` have almost exactly the same AIC. Not that surprising if we guess that 
`Weibull type 3` is probably rather similar to `Weibull type 2`. 

The difference in AIC for the first two distributions tested is very small. Is it
large enough for us to think that `WEI2` is significantly better than `WEI3`?

No. As a general rule of thumb, the difference between the AIC of two distributions
have to be larger than 2 for us to see a significant difference.

We can get more details using the `summary()` function:
```{r}
summary(fit)
```
And we can get at graphical description as well:

```{r}
plot(fit)
```

## Hvordan med de andre muligheder?

Dem kan vi også få: 



```{r}

fitte <- gamlss(eruptions ~ 1, family = LOGNO, data = test)
plot(fitte)
```
Og det var så de fordelinger der er definerede for reelle, positive tal. Vi går efter den mindste "deviance" - afvigelsen fra idealet. Bemærk at jo flere datapunkter vi har, jo større bliver tallene. Det bedste fit er dog stadig det med den laveste værdi.

"realline" dækker kontinuerte fordelingsfunktioner på hele den reelle tallinie

"realplus" dækker kontinuerte fordelingsfunktioner på den positive, reelle tallinie

"realAll" har alle kontinuerte fordelingsfunktioner på hele den relle tallinie, det vil sige alt der er omfattet af "realline" og "realplus"

"real0to1" de kontinuerte fordelingsfunktioner der er defineret for værdier mellem 0 og 1.

"counts" fordelingsfunktioner for tælletal

"binom" fordelingsfunktioner for binomiale data.

Der er mange. Læs mere om dem i [dokumentationen](https://www.gamlss.com/wp-content/uploads/2013/01/gamlss-manual.pdf), særligt appendix A.
   
## Hvordan med de andre fordelinger?

Inde bagved er `fitDist` i virkeligheden gentagne kald til den samme funktion.
Det afsløres i outputtet:
`Call:  gamlssML(formula = y, family = DIST[i])` 

Så vil vi gerne have estimaterne fra de andre funktioner, kan vi få dem ved
at lave samme kald - men med en anden `family`:
```{r}
nyt_fit <- gamlssML(formula = y, family = "GG")

LOGNO2    
nyt_fit
```
Resultatet kan behandles ganske som tidligere.

```{r}
test <- as_tibble(faithful) %>% 
select(eruptions) %>% 
  filter(eruptions > 3)

faithful$eruptions
gamlss(eruptions ~ 1, family = LOGNO2, data = eruption_example) %>% plot()
```


::::::::::::::::::::::::::::::::::::: keypoints 

- The data generating function is not neccesarily the same as the distribution that best fit the data.


::::::::::::::::::::::::::::::::::::::::::::::::

